/*!
 * User: dingding <352926@qq.com>
 * Date: 2017/8/30
 * Time: 14:22
 * Modify: 2018/7/3 11:27
 * https://github.com/352926/turntable
 */
/*! turntable.js v1.0.4 */!function(t){var e={prizes:[{title:"一等奖",color:"#fe807d",font_color:"#000"},{title:"二等奖",color:"#fe7771"},{title:"三等奖",color:"#fe807d"},{title:"四等奖",color:"#fe7771"},{title:"五等奖",color:"#fe807d"},{title:"六等奖",color:"#fe7771"},{title:"谢谢参与",color:"#fe807d"},{title:"谢谢参与",color:"#fe7771"}],default_color:"#fe7771",width:300,height:300,end_color:"#FF5B5C",circle_bgcolor:"#ff5859",circle_shadow_bgcolor:"#ff5758",prize_border_color:"#ffffff",default_font_color:"#ffffff",outside_radius:140,inside_radius:30,text_radius:105,start_angle:0,duration:1e4,lottery_callback_pre_rotate:void 0,lottery_callback:void 0,error_callback:void 0,repeat_callback:void 0,is_lock:!1,bind_go_btn:!1};t.extend(t.fn,{turntable:function(o){if(t(this).length<=0)return!1;t.extend(e,o);var a=e,l=t(this);l.css("-webkit-animation","fd 1s ease both"),l.css("-webkit-animation-delay",".5s"),l.html('<div class="turntable" style="width:'+a.width+"px;height:"+a.height+"px;background-color:"+a.circle_bgcolor+";box-shadow:-1px 2px 4px "+a.circle_shadow_bgcolor+'"><div class="turntable_circle"></div><canvas class="turntable_canvas" width="'+a.width+'" height="'+a.height+'"></canvas><div class="go_btn" style="-webkit-animation:fd 1s ease both;"></div></div>'),!1===a.bind_go_btn&&l.find(".go_btn").on("click",function(){(void 0===a.lottery_callback_pre_rotate||a.lottery_callback_pre_rotate())&&(!0!==e.is_lock?(l.find("canvas.turntable_canvas").rotate({angle:0,animateTo:2071,duration:1e4,callback:function(){void 0!==a.error_callback?a.error_callback(l):alert("抱歉，网络请求异常，请切换网络且刷新后查看中奖结果或者重试"),e.is_lock=!1}}),void 0!==a.lottery_callback&&a.lottery_callback(l),a.bind_go_btn=!0):void 0!==e.repeat_callback&&e.repeat_callback())}),function(t,o){var l=t.getContext("2d");if(t.getContext){var i=Math.PI/(a.prizes.length/2);l.clearRect(0,0,a.width,a.height),l.strokeStyle="#e95455",l.font="16px Microsoft YaHei";for(var r=0;r<a.prizes.length;r++){var c=a.start_angle+r*i;l.fillStyle=void 0===a.prizes[r].color?a.default_color:a.prizes[r].color,l.shadowBlur=1,l.shadowColor=a.prize_border_color,l.beginPath(),l.arc(a.width/2,a.height/2,a.outside_radius,c,c+i,!1),l.arc(a.width/2,a.height/2,a.inside_radius,c+i,c,!0),l.stroke(),l.fill(),l.save(),void 0!=o&&r==o&&(l.fillStyle=a.end_color,l.fill()),l.fillStyle=void 0===a.prizes[r].font_color?a.default_font_color:a.prizes[r].font_color;var n,s,d=a.prizes[r].title;n=a.width/2+Math.cos(c+i/2)*a.text_radius,s=a.height/2+Math.sin(c+i/2)*a.text_radius,l.translate(n,s),l.rotate(c+i/2+Math.PI/2),l.fillText(d,-l.measureText(d).width/2,0),l.restore()}e.is_lock=!1}}(l.find("canvas.turntable_canvas")[0])},set_prize:function(o,a,l){var i=o*(360/e.prizes.length)-360/(2*e.prizes.length);i=i<270?270-i:360-i+270,0===o&&(i=271);var r=t(this);e.is_lock=!0;var c=r.find("canvas.turntable_canvas");c.stopRotate(),c.rotate({angle:0,animateTo:i+1800,duration:void 0===l?e.duration:l,callback:function(){void 0!==a&&a(),e.is_lock=!1}})}})}(Zepto);
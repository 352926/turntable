/*!
 * User: dingding <352926@qq.com>
 * Date: 2017/8/30
 * Time: 14:22
 * https://github.com/352926/turntable
 */
/*! turntable.js v1.0.1 */!function(t){var e={prizes:[{title:"一等奖",color:"#fe807d",font_color:"#000"},{title:"二等奖",color:"#fe7771"},{title:"三等奖",color:"#fe807d"},{title:"四等奖",color:"#fe7771"},{title:"五等奖",color:"#fe807d"},{title:"六等奖",color:"#fe7771"},{title:"谢谢参与",color:"#fe807d"},{title:"谢谢参与",color:"#fe7771"}],default_color:"#fe7771",width:300,height:300,end_color:"#FF5B5C",circle_bgcolor:"#ff5859",circle_shadow_bgcolor:"#ff5758",prize_border_color:"#ffffff",default_font_color:"#ffffff",outside_radius:140,inside_radius:30,text_radius:105,start_angle:0,duration:1e4,lottery_callback:void 0,error_callback:void 0,repeat_callback:void 0,is_lock:!1,bind_go_btn:!1};t.extend(t.fn,{turntable:function(o){if(t(this).length<=0)return!1;t.extend(e,o);var i=e,a=t(this);a.css("-webkit-animation","fd 1s ease both"),a.css("-webkit-animation-delay",".5s"),a.html('<div class="turntable" style="width:'+i.width+"px;height:"+i.height+"px;background-color:"+i.circle_bgcolor+";box-shadow:-1px 2px 4px "+i.circle_shadow_bgcolor+'"><div class="turntable_circle"></div><canvas class="turntable_canvas" width="'+i.width+'" height="'+i.height+'"></canvas><div class="go_btn" style="-webkit-animation:fd 1s ease both;"></div></div>'),void 0!==i.lottery_callback&&!1===i.bind_go_btn&&a.find(".go_btn").on("click",function(){!0!==e.is_lock?(a.find("canvas.turntable_canvas").rotate({angle:0,animateTo:2071,duration:1e4,callback:function(){void 0!==i.error_callback?i.error_callback(a):alert("抱歉，网络请求异常，请切换网络且刷新后查看中奖结果或者重试"),e.is_lock=!1}}),void 0!==i.lottery_callback&&i.lottery_callback(a),i.bind_go_btn=!0):void 0!==e.repeat_callback&&e.repeat_callback()}),function(t,o){var a=t.getContext("2d");if(t.getContext){var l=Math.PI/(i.prizes.length/2);a.clearRect(0,0,i.width,i.height),a.strokeStyle="#e95455",a.font="16px Microsoft YaHei";for(var r=0;r<i.prizes.length;r++){var c=i.start_angle+r*l;a.fillStyle=void 0===i.prizes[r].color?i.default_color:i.prizes[r].color,a.shadowBlur=1,a.shadowColor=i.prize_border_color,a.beginPath(),a.arc(i.width/2,i.height/2,i.outside_radius,c,c+l,!1),a.arc(i.width/2,i.height/2,i.inside_radius,c+l,c,!0),a.stroke(),a.fill(),a.save(),void 0!=o&&r==o&&(a.fillStyle=i.end_color,a.fill()),a.fillStyle=void 0===i.prizes[r].font_color?i.default_font_color:i.prizes[r].font_color;var n,s,d=i.prizes[r].title;n=i.width/2+Math.cos(c+l/2)*i.text_radius,s=i.height/2+Math.sin(c+l/2)*i.text_radius,a.translate(n,s),a.rotate(c+l/2+Math.PI/2),a.fillText(d,-a.measureText(d).width/2,0),a.restore()}e.is_lock=!1}}(a.find("canvas.turntable_canvas")[0])},set_prize:function(o,i){var a=o*(360/e.prizes.length)-360/(2*e.prizes.length);a=a<270?270-a:360-a+270;var l=t(this);e.is_lock=!0;var r=l.find("canvas.turntable_canvas");r.stopRotate(),r.rotate({angle:0,animateTo:a+1800,duration:e.duration,callback:function(){void 0!==i&&i(),e.is_lock=!1}})}})}(Zepto);